tempo:
  queryEndpoint: "https://tempo-simplest-gateway:8080"

namespace: "tempo-perf-test"
tenantId: "tenant-1"

query:
  delay: "5s"
  totalConcurrency: 50  # Total number of concurrent workers across all queries
  targetQPS: 50         # Total queries per second across all workers (distributed as targetQPS / totalConcurrency per worker)
  burstMultiplier: 2.0  # Rate limiter burst multiplier (per-worker burst = perWorkerQPS * burstMultiplier)
  qpsMultiplier: 1.0    # Multiplier to apply to targetQPS for compensation (default: 1.0)
  limit: 1000                  # Maximum number of results to return per query (default: 1000)
  traceFetchProbability: 0.5   # Probability of fetching full trace after search (0.0-1.0, default: 0.5)
  seed: 42                     # Seed for deterministic random number generation (each worker uses seed + workerID)
  bypassCache: false           # Force cache bypass by sending Cache-Control headers (default: false)
  timeWindowJitter: "5m"       # Random shift for time windows to defeat caching (e.g. "5m", "0s" to disable, default: "0s")
  rampUpDuration: "2m"          # Linear ramp from 0 to targetQPS (e.g. "2m", "0s" to disable, default: "0s")
  testDuration: "15m"          # Total test duration including ramp-up (e.g. "15m", "0s" for infinite, default: "0s")
  gracefulShutdownTimeout: "30s" # Max wait for in-flight queries during shutdown (e.g. "30s", default: "30s")

timeBuckets:
  - name: "recent"
    ageStart: "10s"
    ageEnd: "1m"
    weight: 10  # Higher weight = selected more often
  - name: "ingester"
    ageStart: "1m"
    ageEnd: "5m"
    weight: 5
  - name: "backend"
    ageStart: "5m"
    ageEnd: "15m"
    weight: 2

queries:
  # ============================================
  # Simple Resource Queries
  # ============================================
  - name: "resource_service_loadtest"
    traceql: '{ resource.service.name = "frontend" }'
  - name: "resource_service_api_gateway"
    traceql: '{ resource.service.name = "api-gateway" }'
  - name: "resource_service_order"
    traceql: '{ resource.service.name = "order-service" }'

  # ============================================
  # Span Attribute Queries
  # ============================================
  - name: "span_http_get"
    traceql: '{ span.http.method = "GET" }'
  - name: "span_http_post"
    traceql: '{ span.http.method = "POST" }'
  - name: "span_http_status_200"
    traceql: '{ span.http.status_code = 200 }'
  - name: "span_http_status_error"
    traceql: '{ span.http.status_code >= 400 }'
  - name: "span_http_status_server_error"
    traceql: '{ span.http.status_code >= 500 }'

  # ============================================
  # Duration Intrinsic Queries
  # ============================================
  - name: "duration_gt_100ms"
    traceql: '{ duration > 100ms }'
  - name: "duration_gt_500ms"
    traceql: '{ duration > 500ms }'
  - name: "duration_gt_1s"
    traceql: '{ duration > 1s }'
  - name: "duration_lt_50ms"
    traceql: '{ duration < 50ms }'
  - name: "duration_range_100ms_500ms"
    traceql: '{ duration > 100ms && duration < 500ms }'

  # ============================================
  # Status Intrinsic Queries
  # ============================================
  - name: "status_error"
    traceql: '{ status = error }'
  - name: "status_ok"
    traceql: '{ status = ok }'

  # ============================================
  # Kind Intrinsic Queries
  # ============================================
  - name: "kind_server"
    traceql: '{ kind = server }'
  - name: "kind_client"
    traceql: '{ kind = client }'

  # ============================================
  # Simple Logic Queries (&&, ||)
  # ============================================
  - name: "logic_service_and_slow"
    traceql: '{ resource.service.name = "frontend" && duration > 500ms }'
  - name: "logic_post_and_slow"
    traceql: '{ span.http.method = "POST" && duration > 200ms }'
  - name: "logic_get_and_error"
    traceql: '{ span.http.method = "GET" && status = error }'
  - name: "logic_service_and_http_error"
    traceql: '{ resource.service.name = "api-gateway" && span.http.status_code >= 500 }'
  - name: "logic_or_services"
    traceql: '{ resource.service.name = "frontend" || resource.service.name = "api-gateway" }'
  - name: "logic_or_methods"
    traceql: '{ span.http.method = "PUT" || span.http.method = "DELETE" }'

  # ============================================
  # Negation Queries (!=)
  # ============================================
  - name: "negation_not_ok"
    traceql: '{ status != ok }'
  - name: "negation_not_200"
    traceql: '{ span.http.status_code != 200 }'

# ============================================
# Execution Plan
# ============================================
# Define the query execution pattern here.
# Workers use weighted random selection to pick entries from this plan.
# The weight comes from the bucket's weight in the timeBuckets config.
# Workers use seed + workerID for deterministic but unique sequences.

executionPlan:
  # Resource queries - favor recent and ingester buckets
  - queryName: "resource_service_loadtest"
    bucketName: "recent"
  - queryName: "resource_service_api_gateway"
    bucketName: "ingester"
  - queryName: "resource_service_order"
    bucketName: "recent"
  
  # HTTP method/status queries - spread across buckets
  - queryName: "span_http_get"
    bucketName: "recent"
  - queryName: "span_http_post"
    bucketName: "ingester"
  - queryName: "span_http_status_200"
    bucketName: "recent"
  - queryName: "span_http_status_error"
    bucketName: "ingester"
  - queryName: "span_http_status_server_error"
    bucketName: "recent"
  
  # Duration queries - spread across buckets
  - queryName: "duration_gt_100ms"
    bucketName: "ingester"
  - queryName: "duration_gt_500ms"
    bucketName: "recent"
  - queryName: "duration_gt_1s"
    bucketName: "backend"
  - queryName: "duration_lt_50ms"
    bucketName: "ingester"
  - queryName: "duration_range_100ms_500ms"
    bucketName: "recent"
  
  # Status queries - favor recent and ingester
  - queryName: "status_error"
    bucketName: "recent"
  - queryName: "status_ok"
    bucketName: "ingester"
  
  # Kind queries - spread across buckets
  - queryName: "kind_server"
    bucketName: "recent"
  - queryName: "kind_client"
    bucketName: "ingester"
  
  # Simple AND logic queries - favor recent and ingester
  - queryName: "logic_service_and_slow"
    bucketName: "recent"
  - queryName: "logic_post_and_slow"
    bucketName: "ingester"
  - queryName: "logic_get_and_error"
    bucketName: "recent"
  - queryName: "logic_service_and_http_error"
    bucketName: "ingester"
  
  # OR logic queries - spread across buckets
  - queryName: "logic_or_services"
    bucketName: "recent"
  - queryName: "logic_or_methods"
    bucketName: "ingester"
  
  # Negation queries - favor recent and ingester
  - queryName: "negation_not_ok"
    bucketName: "recent"
  - queryName: "negation_not_200"
    bucketName: "ingester"
